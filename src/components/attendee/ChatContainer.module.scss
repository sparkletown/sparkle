@import "scss/AttendeeMixins.scss";

@keyframes scroll-left {
  0% {
    -moz-transform: translateX(50%);
    -webkit-transform: translateX(50%);
    transform: translateX(50%);
  }

  100% {
    -moz-transform: translateX(-100%);
    -webkit-transform: translateX(-100%);
    transform: translateX(-100%);
  }
}

// TODO Tidy this up
@mixin atom-chat-message {
  display: grid;
  grid-column-gap: $whitespace;
  grid-template-columns: min-content auto;

  .user-avatar {
    @include atom-avatar;
    grid-column: 1 / 2;
    grid-row: 1 / 3;
    top: 0.2em;
  }

  .message-meta {
    grid-column: 2 / 3;
    @include font-small;

    h4 {
      display: inline;
    }

    p {
      display: inline;
      overflow: hidden;
      opacity: $opacity;

      span {
        position: absolute;
        top: -1000px;
      }
    }
  }

  .message {
    grid-column: 2 / 3;
  }

  .message-actions {
    grid-column: 2 / 3;
    display: flex;
    flex-wrap: wrap;
    padding-top: $button-gap;

    a {
      @include atom-icon;
      margin-right: $whitespace * 0.5;
      opacity: $opacity;

      &:hover,
      &:focus {
        opacity: 1;
      }

      &.chat-like-button {
        background-image: url(~assets/icons/icon-heart.svg);

        &.liked {
          background-image: url(~assets/icons/icon-heart-fill.svg);
        }

        @media (prefers-color-scheme: dark) {
          filter: invert(1);
        }
      }

      &.chat-reply-button {
        background-image: url(~assets/icons/icon-reply.svg);

        &.clicked {
          display: none;
        }

        @media (prefers-color-scheme: dark) {
          filter: invert(1);
        }
      }

      span {
        position: absolute;
        top: -500px;
      }
    }

    form {
      display: none;
      width: 100%;
      margin-top: $whitespace * 0.5;
      background: transparent;
      border-width: 1px;
      border-style: solid;
      border-color: $sparkle-border;
      @include rounded;
    }

    .chat-reply-button.clicked + form {
      display: block;
    }
  }
}

.ChatContainer {
  padding: 0 $whitespace;

  @media (min-width: 768px) {
    padding: 0;
    width: 100%;
    grid-column: 2 / 3;
  }

  nav {
    display: flex;

    @media (min-width: 768px) {
      @include sparkle-panel;
      @include rounded;
    }

    > a,
    > div {
      @include atom-button;
      position: relative;

      &.radio {
        flex-grow: 1;
        padding-right: 0;

        #component-chat-radio-toggle {
          @include atom-button;
          padding-left: 0;
          padding-right: 0;

          .icon {
            @include atom-icon;
            margin-left: $whitespace * 0.5;
            background-image: url(~assets/icons/icon-unmute.svg);
            filter: invert(1);
          }

          &.muted .icon {
            background-image: url(~assets/icons/icon-mute.svg);
            opacity: $opacity;
          }
        }
      }

      .badge {
        @include atom-badge;
      }

      .live-info {
        position: relative;
        height: $button-height;
        overflow: hidden;
        flex-grow: 1;
        -moz-mask-image: linear-gradient(
          to right,
          rgba(0, 0, 0, 0) 0,
          rgba(0, 0, 0, 1) 10px
        );
        -ms-mask-image: linear-gradient(
          to right,
          rgba(0, 0, 0, 0) 0,
          rgba(0, 0, 0, 1) 10px
        );
        -webkit-mask-image: linear-gradient(
          to right,
          rgba(0, 0, 0, 0) 0,
          rgba(0, 0, 0, 1) 10px
        );
        mask-image: linear-gradient(
          to right,
          rgba(0, 0, 0, 0) 0,
          rgba(0, 0, 0, 1) 10px
        );

        span {
          position: absolute;
          width: min-content;
          height: $button-height;
          line-height: $button-height;
          white-space: nowrap;
          width: min-content;
          opacity: $opacity;
          -moz-transform: translateX(50%);
          -webkit-transform: translateX(50%);
          transform: translateX(50%);
          -moz-animation: scroll-left 10s linear infinite;
          -webkit-animation: scroll-left 10s linear infinite;
          animation: scroll-left 10s linear infinite;
        }
      }
    }

    #component-chat-open-button {
      margin-left: auto;
    }
  }

  #chat-scrollbox {
    position: relative;
    height: 0;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    @include rounded-bottom;

    @media (min-width: 768px) {
    }

    #chat-scrollbox-mask {
      display: flex;
      flex-direction: column-reverse;
      flex-grow: 1;
      overflow: scroll;
      -moz-mask-image: linear-gradient(
        to top,
        rgba(0, 0, 0, 1) 75%,
        rgba(0, 0, 0, 0.5) 95%,
        rgba(0, 0, 0, 0) 100%
      );
      -ms-mask-image: linear-gradient(
        to top,
        rgba(0, 0, 0, 1) 75%,
        rgba(0, 0, 0, 0.5) 95%,
        rgba(0, 0, 0, 0) 100%
      );
      -webkit-mask-image: linear-gradient(
        to top,
        rgba(0, 0, 0, 1) 75%,
        rgba(0, 0, 0, 0.5) 95%,
        rgba(0, 0, 0, 0) 100%
      );
      mask-image: linear-gradient(
        to top,
        rgba(0, 0, 0, 1) 75%,
        rgba(0, 0, 0, 0.5) 95%,
        rgba(0, 0, 0, 0) 100%
      );
    }

    ol {
      display: flex;
      flex-direction: column-reverse;
      padding: 0 $whitespace;

      li {
        min-height: 50px;
        padding: $whitespace * 0.75 0;
        @include atom-chat-message;

        .user-avatar {
          width: $button-height;
          height: $button-height;
        }
      }
    }

    form {
      @include atom-simple-form;
      margin: 0 0 $whitespace;
      background: $canvas-lightmode;

      @media (prefers-color-scheme: dark) {
        background: $canvas-darkmode;
      }

      @media (min-width: 768px) {
        margin: 0 $whitespace $whitespace;
      }
    }
  }

  &.open {
    #chat-scrollbox {
      height: $text-chat-height;
      overflow: visible;
    }

    &.component-table-video-open {
      #chat-scrollbox {
        height: calc(#{$text-chat-height} - #{$video-chat-height});
      }
    }

    @media (min-width: 768px) {
      height: calc(100vh - #{$whitespace * 2});
      margin-top: calc(-100vh + #{$whitespace * 2} + #{$button-height});

      &.component-table-video-open {
        height: calc(100vh - #{$whitespace * 2} - #{$video-chat-height});
        margin-top: calc(
          -100vh + #{$whitespace * 2} + #{$button-height} + #{$video-chat-height}
        );
      }

      display: flex;
      flex-direction: column-reverse;

      nav {
        @include rounded-bottom;
      }

      #chat-scrollbox {
        flex-grow: 1;
        @include sparkle-panel-glass;
        @include rounded-top;
      }
    }
  }
}
